{% extends 'base.html' %}
{% load static %}

{% block title %}Expense {{ expense.expense_number }} - Details{% endblock %}

{% block page_title %}Expense Details{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Header -->
    <div class="glass-card p-6 mb-6">
        <div class="flex items-center justify-between">
            <div>
                <div class="flex items-center space-x-3 mb-2">
                    <h2 class="text-2xl font-bold text-white">Expense #{{ expense.expense_number }}</h2>
                    <span class="badge 
                        {% if expense.payment_status == 'paid' %}badge-success
                        {% elif expense.payment_status == 'approved' %}badge-info
                        {% elif expense.payment_status == 'pending' %}badge-warning
                        {% else %}badge-error{% endif %}">
                        {{ expense.get_payment_status_display }}
                    </span>
                </div>
                <p class="text-white/60">{{ expense.expense_date|date:"l, d M Y" }}</p>
            </div>
            <div class="flex space-x-2">
                <a href="{% url 'finance:expense_edit' expense.id %}" class="glass-button">
                    <i class="fas fa-edit mr-2"></i>Edit
                </a>
                <a href="{% url 'finance:expense_list' %}" class="glass-button">
                    <i class="fas fa-arrow-left mr-2"></i>Back
                </a>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Left Column - Expense Details -->
        <div class="lg:col-span-2 space-y-6">
            <!-- Expense Information -->
            <div class="glass-card">
                <div class="border-b border-white/20 px-6 py-4">
                    <h3 class="text-lg font-semibold text-white">Expense Information</h3>
                </div>
                <div class="p-6">
                    <dl class="space-y-4">
                        <div>
                            <dt class="text-sm text-white/60">Category</dt>
                            <dd class="mt-1">
                                <span class="badge badge-info">{{ expense.category.name }}</span>
                            </dd>
                        </div>
                        <div>
                            <dt class="text-sm text-white/60">Description</dt>
                            <dd class="mt-1 text-white bg-white/5 rounded-lg p-3">{{ expense.description|linebreaks }}</dd>
                        </div>
                        <div>
                            <dt class="text-sm text-white/60">Amount</dt>
                            <dd class="mt-1 text-2xl font-bold text-yellow-400">KSh {{ expense.amount|floatformat:2 }}</dd>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <dt class="text-sm text-white/60">Payment Method</dt>
                                <dd class="mt-1 text-white">{{ expense.get_payment_method_display }}</dd>
                            </div>
                            <div>
                                <dt class="text-sm text-white/60">Payment Status</dt>
                                <dd class="mt-1">
                                    <span class="badge 
                                        {% if expense.payment_status == 'paid' %}badge-success
                                        {% elif expense.payment_status == 'approved' %}badge-info
                                        {% elif expense.payment_status == 'pending' %}badge-warning
                                        {% else %}badge-error{% endif %}">
                                        {{ expense.get_payment_status_display }}
                                    </span>
                                </dd>
                            </div>
                        </div>
                        {% if expense.payment_date %}
                        <div>
                            <dt class="text-sm text-white/60">Payment Date</dt>
                            <dd class="mt-1 text-white">{{ expense.payment_date|date:"d M Y" }}</dd>
                        </div>
                        {% endif %}
                    </dl>
                </div>
            </div>

            <!-- Vendor Information -->
            <div class="glass-card">
                <div class="border-b border-white/20 px-6 py-4">
                    <h3 class="text-lg font-semibold text-white">Vendor Information</h3>
                </div>
                <div class="p-6">
                    <dl class="space-y-3">
                        <div class="flex justify-between">
                            <dt class="text-sm text-white/60">Vendor Name</dt>
                            <dd class="text-sm text-white">{{ expense.vendor_name }}</dd>
                        </div>
                        {% if expense.vendor_phone %}
                        <div class="flex justify-between">
                            <dt class="text-sm text-white/60">Phone</dt>
                            <dd class="text-sm text-white">{{ expense.vendor_phone }}</dd>
                        </div>
                        {% endif %}
                        {% if expense.vendor_email %}
                        <div class="flex justify-between">
                            <dt class="text-sm text-white/60">Email</dt>
                            <dd class="text-sm text-white">{{ expense.vendor_email }}</dd>
                        </div>
                        {% endif %}
                    </dl>
                </div>
            </div>

            <!-- Notes -->
            {% if expense.notes %}
            <div class="glass-card">
                <div class="border-b border-white/20 px-6 py-4">
                    <h3 class="text-lg font-semibold text-white">Notes</h3>
                </div>
                <div class="p-6">
                    <p class="text-white/80">{{ expense.notes|linebreaks }}</p>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Right Column - Meta & Actions -->
        <div class="space-y-6">
            <!-- Receipt -->
            {% if expense.receipt %}
            <div class="glass-card">
                <div class="border-b border-white/20 px-6 py-4">
                    <h3 class="text-lg font-semibold text-white">Receipt</h3>
                </div>
                <div class="p-6">
                    <a href="{{ expense.receipt.url }}" target="_blank" class="glass-button w-full">
                        <i class="fas fa-file-pdf mr-2"></i>View Receipt
                    </a>
                    <p class="text-xs text-white/40 text-center mt-2">{{ expense.receipt.name|slice:"14:" }}</p>
                </div>
            </div>
            {% endif %}

            <!-- Approval Info -->
            {% if expense.approved_by %}
            <div class="glass-card">
                <div class="border-b border-white/20 px-6 py-4">
                    <h3 class="text-lg font-semibold text-white">Approval Information</h3>
                </div>
                <div class="p-6">
                    <dl class="space-y-3">
                        <div class="flex justify-between">
                            <dt class="text-sm text-white/60">Approved By</dt>
                            <dd class="text-sm text-white">{{ expense.approved_by.get_full_name }}</dd>
                        </div>
                        <div class="flex justify-between">
                            <dt class="text-sm text-white/60">Approved At</dt>
                            <dd class="text-sm text-white">{{ expense.approved_at|date:"d M Y H:i" }}</dd>
                        </div>
                    </dl>
                </div>
            </div>
            {% endif %}

            <!-- Metadata -->
            <div class="glass-card">
                <div class="border-b border-white/20 px-6 py-4">
                    <h3 class="text-lg font-semibold text-white">Metadata</h3>
                </div>
                <div class="p-6">
                    <dl class="space-y-3">
                        <div class="flex justify-between">
                            <dt class="text-sm text-white/60">Created By</dt>
                            <dd class="text-sm text-white">{{ expense.created_by.get_full_name|default:"System" }}</dd>
                        </div>
                        <div class="flex justify-between">
                            <dt class="text-sm text-white/60">Created At</dt>
                            <dd class="text-sm text-white">{{ expense.created_at|date:"d M Y H:i" }}</dd>
                        </div>
                        <div class="flex justify-between">
                            <dt class="text-sm text-white/60">Last Updated</dt>
                            <dd class="text-sm text-white">{{ expense.updated_at|date:"d M Y H:i" }}</dd>
                        </div>
                    </dl>
                </div>
            </div>

            <!-- Actions -->
            {% if user.is_admin and expense.payment_status == 'pending' %}
            <div class="glass-card">
                <div class="border-b border-white/20 px-6 py-4">
                    <h3 class="text-lg font-semibold text-white">Actions</h3>
                </div>
                <div class="p-6 space-y-3">
                    <a href="{% url 'finance:expense_approve' expense.id %}?action=approve" class="glass-button w-full bg-green-600/50">
                        <i class="fas fa-check-circle mr-2"></i>Approve
                    </a>
                    <a href="{% url 'finance:expense_approve' expense.id %}?action=reject" class="glass-button w-full bg-red-600/50">
                        <i class="fas fa-times-circle mr-2"></i>Reject
                    </a>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}