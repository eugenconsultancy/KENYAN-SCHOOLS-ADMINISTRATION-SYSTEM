{% extends 'base.html' %}
{% load static %}

{% block title %}{{ title }} - Kenyan Schools System{% endblock %}

{% block page_title %}{{ title }}{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Debug Information - Remove in production -->
    {% if teacher %}
    <div class="bg-yellow-500/20 border border-yellow-500/30 rounded-lg p-4 mb-4">
        <div class="flex items-center">
            <i class="fas fa-info-circle text-yellow-400 mr-3 text-xl"></i>
            <div>
                <p class="text-yellow-400 font-medium">DEBUG: Editing Mode</p>
                <p class="text-yellow-400/80 text-sm">Teacher ID: {{ teacher.id }} - {{ teacher.get_full_name }}</p>
                <p class="text-yellow-400/60 text-xs">Form will submit to: {% url 'teachers:edit' teacher.id %}</p>
            </div>
        </div>
    </div>
    {% else %}
    <div class="bg-green-500/20 border border-green-500/30 rounded-lg p-4 mb-4">
        <div class="flex items-center">
            <i class="fas fa-info-circle text-green-400 mr-3 text-xl"></i>
            <div>
                <p class="text-green-400 font-medium">DEBUG: Create Mode</p>
                <p class="text-green-400/80 text-sm">Creating new teacher</p>
                <p class="text-green-400/60 text-xs">Form will submit to: {% url 'teachers:create' %}</p>
            </div>
        </div>
    </div>
    {% endif %}

    <div class="glass-card p-6">
        <form method="post" enctype="multipart/form-data" 
              action="{% if teacher %}{% url 'teachers:edit' teacher.id %}{% else %}{% url 'teachers:create' %}{% endif %}" 
              class="space-y-6">
            {% csrf_token %}
            
            {% if form.non_field_errors %}
            <div class="alert-error p-4 rounded-lg">
                {% for error in form.non_field_errors %}
                <p class="text-sm">{{ error }}</p>
                {% endfor %}
            </div>
            {% endif %}
            
            <!-- Hidden field to indicate this is a create form -->
            {% if not teacher %}
            <input type="hidden" name="action" value="create">
            {% endif %}
            
            <!-- User Account Information -->
            <div>
                <h3 class="text-lg font-semibold text-white mb-4">Account Information</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="{{ form.username.id_for_label }}" class="form-label">
                            Username <span class="text-red-400">*</span>
                        </label>
                        <input type="text" name="{{ form.username.name }}" id="{{ form.username.id_for_label }}" 
                               value="{{ form.username.value|default:'' }}" class="glass-input" required>
                        {% if form.username.errors %}
                        <p class="text-sm text-red-400 mt-1">{{ form.username.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="{{ form.email.id_for_label }}" class="form-label">
                            Email <span class="text-red-400">*</span>
                        </label>
                        <input type="email" name="{{ form.email.name }}" id="{{ form.email.id_for_label }}" 
                               value="{{ form.email.value|default:'' }}" class="glass-input" required>
                        {% if form.email.errors %}
                        <p class="text-sm text-red-400 mt-1">{{ form.email.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="{{ form.first_name.id_for_label }}" class="form-label">
                            First Name <span class="text-red-400">*</span>
                        </label>
                        <input type="text" name="{{ form.first_name.name }}" id="{{ form.first_name.id_for_label }}" 
                               value="{{ form.first_name.value|default:'' }}" class="glass-input" required>
                        {% if form.first_name.errors %}
                        <p class="text-sm text-red-400 mt-1">{{ form.first_name.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="{{ form.last_name.id_for_label }}" class="form-label">
                            Last Name <span class="text-red-400">*</span>
                        </label>
                        <input type="text" name="{{ form.last_name.name }}" id="{{ form.last_name.id_for_label }}" 
                               value="{{ form.last_name.value|default:'' }}" class="glass-input" required>
                        {% if form.last_name.errors %}
                        <p class="text-sm text-red-400 mt-1">{{ form.last_name.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="{{ form.password.id_for_label }}" class="form-label">
                            Password
                        </label>
                        <input type="password" name="{{ form.password.name }}" id="{{ form.password.id_for_label }}" 
                               class="glass-input" {% if not teacher %}required{% endif %}>
                        {% if form.password.help_text %}
                        <p class="text-xs text-white/60 mt-1">{{ form.password.help_text }}</p>
                        {% endif %}
                        {% if form.password.errors %}
                        <p class="text-sm text-red-400 mt-1">{{ form.password.errors.0 }}</p>
                        {% endif %}
                        {% if teacher %}
                        <p class="text-xs text-white/40 mt-1">Leave blank to keep current password</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <div class="border-t border-white/20 my-6"></div>
            
            <!-- Personal Information -->
            <div>
                <h3 class="text-lg font-semibold text-white mb-4">Personal Information</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label for="{{ form.employee_number.id_for_label }}" class="form-label">
                            Employee Number <span class="text-red-400">*</span>
                        </label>
                        <input type="text" name="{{ form.employee_number.name }}" id="{{ form.employee_number.id_for_label }}" 
                               value="{{ form.employee_number.value|default:'' }}" class="glass-input" required>
                        {% if form.employee_number.errors %}
                        <p class="text-sm text-red-400 mt-1">{{ form.employee_number.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="{{ form.tsc_number.id_for_label }}" class="form-label">
                            TSC Number <span class="text-red-400">*</span>
                        </label>
                        <input type="text" name="{{ form.tsc_number.name }}" id="{{ form.tsc_number.id_for_label }}" 
                               value="{{ form.tsc_number.value|default:'' }}" class="glass-input" required>
                        {% if form.tsc_number.errors %}
                        <p class="text-sm text-red-400 mt-1">{{ form.tsc_number.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="{{ form.id_number.id_for_label }}" class="form-label">
                            National ID <span class="text-red-400">*</span>
                        </label>
                        <input type="text" name="{{ form.id_number.name }}" id="{{ form.id_number.id_for_label }}" 
                               value="{{ form.id_number.value|default:'' }}" class="glass-input" required>
                        {% if form.id_number.errors %}
                        <p class="text-sm text-red-400 mt-1">{{ form.id_number.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="{{ form.date_of_birth.id_for_label }}" class="form-label">
                            Date of Birth <span class="text-red-400">*</span>
                        </label>
                        <input type="date" name="{{ form.date_of_birth.name }}" id="{{ form.date_of_birth.id_for_label }}" 
                               value="{{ form.date_of_birth.value|default:'' }}" class="glass-input" required>
                        {% if form.date_of_birth.errors %}
                        <p class="text-sm text-red-400 mt-1">{{ form.date_of_birth.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="{{ form.gender.id_for_label }}" class="form-label">
                            Gender <span class="text-red-400">*</span>
                        </label>
                        <select name="{{ form.gender.name }}" id="{{ form.gender.id_for_label }}" class="glass-input" required>
                            <option value="">Select Gender</option>
                            {% for value, label in form.gender.field.choices %}
                                {% if value %}
                                <option value="{{ value }}" {% if form.gender.value == value %}selected{% endif %}>{{ label }}</option>
                                {% endif %}
                            {% endfor %}
                        </select>
                        {% if form.gender.errors %}
                        <p class="text-sm text-red-400 mt-1">{{ form.gender.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="{{ form.marital_status.id_for_label }}" class="form-label">
                            Marital Status
                        </label>
                        <select name="{{ form.marital_status.name }}" id="{{ form.marital_status.id_for_label }}" class="glass-input">
                            <option value="">Select Status</option>
                            {% for value, label in form.marital_status.field.choices %}
                                {% if value %}
                                <option value="{{ value }}" {% if form.marital_status.value == value %}selected{% endif %}>{{ label }}</option>
                                {% endif %}
                            {% endfor %}
                        </select>
                        {% if form.marital_status.errors %}
                        <p class="text-sm text-red-400 mt-1">{{ form.marital_status.errors.0 }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Professional Information -->
            <div>
                <h3 class="text-lg font-semibold text-white mb-4">Professional Information</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="{{ form.qualification_level.id_for_label }}" class="form-label">
                            Qualification Level <span class="text-red-400">*</span>
                        </label>
                        <select name="{{ form.qualification_level.name }}" id="{{ form.qualification_level.id_for_label }}" class="glass-input" required>
                            <option value="">Select Qualification</option>
                            {% for value, label in form.qualification_level.field.choices %}
                                {% if value %}
                                <option value="{{ value }}" {% if form.qualification_level.value == value %}selected{% endif %}>{{ label }}</option>
                                {% endif %}
                            {% endfor %}
                        </select>
                        {% if form.qualification_level.errors %}
                        <p class="text-sm text-red-400 mt-1">{{ form.qualification_level.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="{{ form.specialization.id_for_label }}" class="form-label">
                            Specialization
                        </label>
                        <input type="text" name="{{ form.specialization.name }}" id="{{ form.specialization.id_for_label }}" 
                               value="{{ form.specialization.value|default:'' }}" class="glass-input" placeholder="e.g., Mathematics, Physics">
                        {% if form.specialization.errors %}
                        <p class="text-sm text-red-400 mt-1">{{ form.specialization.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div class="md:col-span-2">
                        <label for="{{ form.qualifications.id_for_label }}" class="form-label">
                            Qualifications <span class="text-red-400">*</span>
                        </label>
                        <textarea name="{{ form.qualifications.name }}" id="{{ form.qualifications.id_for_label }}" 
                                  rows="4" class="glass-input" placeholder="List your qualifications and certifications">{{ form.qualifications.value|default:'' }}</textarea>
                        {% if form.qualifications.help_text %}
                        <p class="text-xs text-white/60 mt-1">{{ form.qualifications.help_text }}</p>
                        {% endif %}
                        {% if form.qualifications.errors %}
                        <p class="text-sm text-red-400 mt-1">{{ form.qualifications.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="{{ form.years_of_experience.id_for_label }}" class="form-label">
                            Years of Experience
                        </label>
                        <input type="number" name="{{ form.years_of_experience.name }}" id="{{ form.years_of_experience.id_for_label }}" 
                               value="{{ form.years_of_experience.value|default:'0' }}" class="glass-input" min="0">
                        {% if form.years_of_experience.errors %}
                        <p class="text-sm text-red-400 mt-1">{{ form.years_of_experience.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="{{ form.date_employed.id_for_label }}" class="form-label">
                            Date Employed <span class="text-red-400">*</span>
                        </label>
                        <input type="date" name="{{ form.date_employed.name }}" id="{{ form.date_employed.id_for_label }}" 
                               value="{{ form.date_employed.value|default:'' }}" class="glass-input" required>
                        {% if form.date_employed.errors %}
                        <p class="text-sm text-red-400 mt-1">{{ form.date_employed.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="{{ form.employment_type.id_for_label }}" class="form-label">
                            Employment Type <span class="text-red-400">*</span>
                        </label>
                        <select name="{{ form.employment_type.name }}" id="{{ form.employment_type.id_for_label }}" class="glass-input" required>
                            <option value="">Select Type</option>
                            {% for value, label in form.employment_type.field.choices %}
                                {% if value %}
                                <option value="{{ value }}" {% if form.employment_type.value == value %}selected{% endif %}>{{ label }}</option>
                                {% endif %}
                            {% endfor %}
                        </select>
                        {% if form.employment_type.errors %}
                        <p class="text-sm text-red-400 mt-1">{{ form.employment_type.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div class="flex items-center">
                        <label for="{{ form.is_active.id_for_label }}" class="flex items-center cursor-pointer">
                            <input type="checkbox" name="{{ form.is_active.name }}" id="{{ form.is_active.id_for_label }}" 
                                   {% if form.is_active.value %}checked{% endif %} class="form-checkbox h-5 w-5 text-blue-600">
                            <span class="ml-2 text-white">Active Teacher</span>
                        </label>
                    </div>
                </div>
            </div>
            
            <!-- Contact Information -->
            <div>
                <h3 class="text-lg font-semibold text-white mb-4">Contact Information</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="{{ form.phone_number.id_for_label }}" class="form-label">
                            Phone Number <span class="text-red-400">*</span>
                        </label>
                        <input type="text" name="{{ form.phone_number.name }}" id="{{ form.phone_number.id_for_label }}" 
                               value="{{ form.phone_number.value|default:'' }}" class="glass-input" required>
                        {% if form.phone_number.errors %}
                        <p class="text-sm text-red-400 mt-1">{{ form.phone_number.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="{{ form.alternative_phone.id_for_label }}" class="form-label">
                            Alternative Phone
                        </label>
                        <input type="text" name="{{ form.alternative_phone.name }}" id="{{ form.alternative_phone.id_for_label }}" 
                               value="{{ form.alternative_phone.value|default:'' }}" class="glass-input">
                        {% if form.alternative_phone.errors %}
                        <p class="text-sm text-red-400 mt-1">{{ form.alternative_phone.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div class="md:col-span-2">
                        <label for="{{ form.physical_address.id_for_label }}" class="form-label">
                            Physical Address
                        </label>
                        <textarea name="{{ form.physical_address.name }}" id="{{ form.physical_address.id_for_label }}" 
                                  rows="2" class="glass-input">{{ form.physical_address.value|default:'' }}</textarea>
                        {% if form.physical_address.errors %}
                        <p class="text-sm text-red-400 mt-1">{{ form.physical_address.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="{{ form.postal_address.id_for_label }}" class="form-label">
                            Postal Address
                        </label>
                        <input type="text" name="{{ form.postal_address.name }}" id="{{ form.postal_address.id_for_label }}" 
                               value="{{ form.postal_address.value|default:'' }}" class="glass-input">
                        {% if form.postal_address.errors %}
                        <p class="text-sm text-red-400 mt-1">{{ form.postal_address.errors.0 }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Emergency Contact -->
            <div>
                <h3 class="text-lg font-semibold text-white mb-4">Emergency Contact</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label for="{{ form.emergency_contact_name.id_for_label }}" class="form-label">
                            Contact Name <span class="text-red-400">*</span>
                        </label>
                        <input type="text" name="{{ form.emergency_contact_name.name }}" id="{{ form.emergency_contact_name.id_for_label }}" 
                               value="{{ form.emergency_contact_name.value|default:'' }}" class="glass-input" required>
                        {% if form.emergency_contact_name.errors %}
                        <p class="text-sm text-red-400 mt-1">{{ form.emergency_contact_name.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="{{ form.emergency_contact_phone.id_for_label }}" class="form-label">
                            Contact Phone <span class="text-red-400">*</span>
                        </label>
                        <input type="text" name="{{ form.emergency_contact_phone.name }}" id="{{ form.emergency_contact_phone.id_for_label }}" 
                               value="{{ form.emergency_contact_phone.value|default:'' }}" class="glass-input" required>
                        {% if form.emergency_contact_phone.errors %}
                        <p class="text-sm text-red-400 mt-1">{{ form.emergency_contact_phone.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="{{ form.emergency_contact_relationship.id_for_label }}" class="form-label">
                            Relationship <span class="text-red-400">*</span>
                        </label>
                        <input type="text" name="{{ form.emergency_contact_relationship.name }}" id="{{ form.emergency_contact_relationship.id_for_label }}" 
                               value="{{ form.emergency_contact_relationship.value|default:'' }}" class="glass-input" required>
                        {% if form.emergency_contact_relationship.errors %}
                        <p class="text-sm text-red-400 mt-1">{{ form.emergency_contact_relationship.errors.0 }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Bank Details -->
            <div>
                <h3 class="text-lg font-semibold text-white mb-4">Bank Details (Optional)</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="{{ form.bank_name.id_for_label }}" class="form-label">
                            Bank Name
                        </label>
                        <input type="text" name="{{ form.bank_name.name }}" id="{{ form.bank_name.id_for_label }}" 
                               value="{{ form.bank_name.value|default:'' }}" class="glass-input">
                        {% if form.bank_name.errors %}
                        <p class="text-sm text-red-400 mt-1">{{ form.bank_name.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="{{ form.bank_branch.id_for_label }}" class="form-label">
                            Bank Branch
                        </label>
                        <input type="text" name="{{ form.bank_branch.name }}" id="{{ form.bank_branch.id_for_label }}" 
                               value="{{ form.bank_branch.value|default:'' }}" class="glass-input">
                        {% if form.bank_branch.errors %}
                        <p class="text-sm text-red-400 mt-1">{{ form.bank_branch.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="{{ form.bank_account.id_for_label }}" class="form-label">
                            Account Number
                        </label>
                        <input type="text" name="{{ form.bank_account.name }}" id="{{ form.bank_account.id_for_label }}" 
                               value="{{ form.bank_account.value|default:'' }}" class="glass-input">
                        {% if form.bank_account.errors %}
                        <p class="text-sm text-red-400 mt-1">{{ form.bank_account.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="{{ form.bank_code.id_for_label }}" class="form-label">
                            Bank Code
                        </label>
                        <input type="text" name="{{ form.bank_code.name }}" id="{{ form.bank_code.id_for_label }}" 
                               value="{{ form.bank_code.value|default:'' }}" class="glass-input">
                        {% if form.bank_code.errors %}
                        <p class="text-sm text-red-400 mt-1">{{ form.bank_code.errors.0 }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Medical Information -->
            <div>
                <h3 class="text-lg font-semibold text-white mb-4">Medical Information (Optional)</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="{{ form.blood_group.id_for_label }}" class="form-label">
                            Blood Group
                        </label>
                        <input type="text" name="{{ form.blood_group.name }}" id="{{ form.blood_group.id_for_label }}" 
                               value="{{ form.blood_group.value|default:'' }}" class="glass-input" placeholder="e.g., O+, A-">
                        {% if form.blood_group.errors %}
                        <p class="text-sm text-red-400 mt-1">{{ form.blood_group.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div class="md:col-span-2">
                        <label for="{{ form.medical_conditions.id_for_label }}" class="form-label">
                            Medical Conditions / Allergies
                        </label>
                        <textarea name="{{ form.medical_conditions.name }}" id="{{ form.medical_conditions.id_for_label }}" 
                                  rows="3" class="glass-input">{{ form.medical_conditions.value|default:'' }}</textarea>
                        {% if form.medical_conditions.errors %}
                        <p class="text-sm text-red-400 mt-1">{{ form.medical_conditions.errors.0 }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Documents -->
            <div>
                <h3 class="text-lg font-semibold text-white mb-4">Documents (Optional)</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label for="{{ form.passport_photo.id_for_label }}" class="form-label">
                            Passport Photo
                        </label>
                        <input type="file" name="{{ form.passport_photo.name }}" id="{{ form.passport_photo.id_for_label }}" 
                               class="glass-input" accept="image/*">
                        {% if form.passport_photo.errors %}
                        <p class="text-sm text-red-400 mt-1">{{ form.passport_photo.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="{{ form.cv.id_for_label }}" class="form-label">
                            CV / Resume
                        </label>
                        <input type="file" name="{{ form.cv.name }}" id="{{ form.cv.id_for_label }}" 
                               class="glass-input" accept=".pdf,.doc,.docx">
                        {% if form.cv.errors %}
                        <p class="text-sm text-red-400 mt-1">{{ form.cv.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="{{ form.contract.id_for_label }}" class="form-label">
                            Employment Contract
                        </label>
                        <input type="file" name="{{ form.contract.name }}" id="{{ form.contract.id_for_label }}" 
                               class="glass-input" accept=".pdf,.doc,.docx">
                        {% if form.contract.errors %}
                        <p class="text-sm text-red-400 mt-1">{{ form.contract.errors.0 }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Form Actions -->
            <div class="flex justify-end space-x-3 pt-6 border-t border-white/20">
                <a href="{% if teacher %}{% url 'teachers:detail' teacher.id %}{% else %}{% url 'teachers:list' %}{% endif %}" 
                   class="glass-button">
                    Cancel
                </a>
                <button type="submit" class="glass-button bg-blue-600/50">
                    <i class="fas fa-save mr-2"></i>{% if teacher %}Update{% else %}Create{% endif %} Teacher
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}