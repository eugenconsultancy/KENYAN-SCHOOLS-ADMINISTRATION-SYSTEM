{% comment %}
=====================================
FORM COMPONENTS LIBRARY
=====================================
Usage: {% include 'components/forms.html' with type='input' field=form.name %}
=====================================
{% endcomment %}

{% load static %}

<!-- Text Input Component -->
{% if type == 'input' %}
<div class="mb-4">
    <label for="{{ field.id_for_label }}" class="form-label {% if required %}required-field{% endif %}">
        {{ label|default:field.label }}
        {% if required %}<span class="text-red-400 ml-1">*</span>{% endif %}
    </label>
    
    <div class="relative">
        {% if icon %}
        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <i class="fas fa-{{ icon }} text-white/40"></i>
        </div>
        {% endif %}
        
        <input type="{{ type|default:'text' }}" 
               name="{{ field.name }}" 
               id="{{ field.id_for_label }}" 
               value="{{ field.value|default:'' }}" 
               class="glass-input {% if icon %}pl-10{% endif %} {% if field.errors %}border-red-500/50 focus:border-red-500{% endif %}" 
               placeholder="{{ placeholder|default:field.label }}"
               {% if required %}required{% endif %}
               {% if disabled %}disabled{% endif %}>
        
        {% if help_text %}
        <p class="text-xs text-white/40 mt-1">{{ help_text }}</p>
        {% endif %}
        
        {% if field.errors %}
        <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
            <i class="fas fa-exclamation-circle text-red-400"></i>
        </div>
        {% endif %}
    </div>
    
    {% if field.errors %}
    <ul class="errorlist mt-2">
        {% for error in field.errors %}
        <li class="text-sm text-red-400">{{ error }}</li>
        {% endfor %}
    </ul>
    {% endif %}
</div>
{% endif %}

<!-- Select/Dropdown Component -->
{% if type == 'select' %}
<div class="mb-4">
    <label for="{{ field.id_for_label }}" class="form-label {% if required %}required-field{% endif %}">
        {{ label|default:field.label }}
        {% if required %}<span class="text-red-400 ml-1">*</span>{% endif %}
    </label>
    
    <div class="relative">
        <select name="{{ field.name }}" 
                id="{{ field.id_for_label }}" 
                class="glass-input appearance-none {% if field.errors %}border-red-500/50 focus:border-red-500{% endif %}" 
                {% if required %}required{% endif %}
                {% if disabled %}disabled{% endif %}>
            <option value="">Select {{ label|default:field.label }}</option>
            {% for value, option_label in choices|default:field.field.choices %}
                {% if value %}
                <option value="{{ value }}" {% if field.value|stringformat:"s" == value|stringformat:"s" %}selected{% endif %}>
                    {{ option_label }}
                </option>
                {% endif %}
            {% endfor %}
        </select>
        
        <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
            <i class="fas fa-chevron-down text-white/40"></i>
        </div>
    </div>
    
    {% if field.errors %}
    <ul class="errorlist mt-2">
        {% for error in field.errors %}
        <li class="text-sm text-red-400">{{ error }}</li>
        {% endfor %}
    </ul>
    {% endif %}
</div>
{% endif %}

<!-- Textarea Component -->
{% if type == 'textarea' %}
<div class="mb-4">
    <label for="{{ field.id_for_label }}" class="form-label {% if required %}required-field{% endif %}">
        {{ label|default:field.label }}
        {% if required %}<span class="text-red-400 ml-1">*</span>{% endif %}
    </label>
    
    <textarea name="{{ field.name }}" 
              id="{{ field.id_for_label }}" 
              rows="{{ rows|default:4 }}" 
              class="glass-input {% if field.errors %}border-red-500/50 focus:border-red-500{% endif %}" 
              placeholder="{{ placeholder|default:field.label }}"
              {% if required %}required{% endif %}
              {% if disabled %}disabled{% endif %}>{{ field.value|default:'' }}</textarea>
    
    {% if help_text %}
    <p class="text-xs text-white/40 mt-1">{{ help_text }}</p>
    {% endif %}
    
    {% if field.errors %}
    <ul class="errorlist mt-2">
        {% for error in field.errors %}
        <li class="text-sm text-red-400">{{ error }}</li>
        {% endfor %}
    </ul>
    {% endif %}
</div>
{% endif %}

<!-- Checkbox Component -->
{% if type == 'checkbox' %}
<div class="mb-4">
    <label class="flex items-center cursor-pointer">
        <input type="checkbox" 
               name="{{ field.name }}" 
               id="{{ field.id_for_label }}" 
               {% if field.value %}checked{% endif %}
               class="form-checkbox h-5 w-5 text-blue-600 rounded border-white/20 bg-white/5"
               {% if disabled %}disabled{% endif %}>
        <span class="ml-2 text-white/80">{{ label|default:field.label }}</span>
    </label>
    
    {% if help_text %}
    <p class="text-xs text-white/40 mt-1 ml-7">{{ help_text }}</p>
    {% endif %}
    
    {% if field.errors %}
    <ul class="errorlist mt-2 ml-7">
        {% for error in field.errors %}
        <li class="text-sm text-red-400">{{ error }}</li>
        {% endfor %}
    </ul>
    {% endif %}
</div>
{% endif %}

<!-- Radio Group Component -->
{% if type == 'radio' %}
<div class="mb-4">
    <label class="form-label {% if required %}required-field{% endif %}">
        {{ label|default:field.label }}
        {% if required %}<span class="text-red-400 ml-1">*</span>{% endif %}
    </label>
    
    <div class="space-y-2">
        {% for value, option_label in choices|default:field.field.choices %}
            {% if value %}
            <label class="flex items-center cursor-pointer">
                <input type="radio" 
                       name="{{ field.name }}" 
                       value="{{ value }}"
                       {% if field.value|stringformat:"s" == value|stringformat:"s" %}checked{% endif %}
                       class="form-radio h-5 w-5 text-blue-600 border-white/20 bg-white/5"
                       {% if required %}required{% endif %}
                       {% if disabled %}disabled{% endif %}>
                <span class="ml-2 text-white/80">{{ option_label }}</span>
            </label>
            {% endif %}
        {% endfor %}
    </div>
    
    {% if field.errors %}
    <ul class="errorlist mt-2">
        {% for error in field.errors %}
        <li class="text-sm text-red-400">{{ error }}</li>
        {% endfor %}
    </ul>
    {% endif %}
</div>
{% endif %}

<!-- File Upload Component -->
{% if type == 'file' %}
<div class="mb-4">
    <label for="{{ field.id_for_label }}" class="form-label {% if required %}required-field{% endif %}">
        {{ label|default:field.label }}
        {% if required %}<span class="text-red-400 ml-1">*</span>{% endif %}
    </label>
    
    <div class="relative">
        <input type="file" 
               name="{{ field.name }}" 
               id="{{ field.id_for_label }}" 
               accept="{{ accept|default:'*' }}"
               class="hidden"
               {% if required %}required{% endif %}
               {% if disabled %}disabled{% endif %}
               onchange="updateFileName(this)">
        
        <div class="flex items-center space-x-3">
            <button type="button" 
                    onclick="document.getElementById('{{ field.id_for_label }}').click()" 
                    class="glass-button">
                <i class="fas fa-folder-open mr-2"></i>Choose File
            </button>
            <span class="file-name text-white/60 flex-1 truncate" id="file-name-{{ field.id_for_label }}">
                {% if field.value %}Current: {{ field.value.name }}{% else %}No file chosen{% endif %}
            </span>
        </div>
    </div>
    
    {% if help_text %}
    <p class="text-xs text-white/40 mt-1">{{ help_text }}</p>
    {% endif %}
    
    {% if field.errors %}
    <ul class="errorlist mt-2">
        {% for error in field.errors %}
        <li class="text-sm text-red-400">{{ error }}</li>
        {% endfor %}
    </ul>
    {% endif %}
</div>

<script>
function updateFileName(input) {
    const fileName = document.getElementById('file-name-{{ field.id_for_label }}');
    if (input.files.length > 0) {
        fileName.textContent = input.files[0].name;
        fileName.classList.remove('text-white/60');
        fileName.classList.add('text-green-400');
    } else {
        fileName.textContent = 'No file chosen';
        fileName.classList.remove('text-green-400');
        fileName.classList.add('text-white/60');
    }
}
</script>
{% endif %}

<!-- Date Picker Component -->
{% if type == 'date' %}
<div class="mb-4">
    <label for="{{ field.id_for_label }}" class="form-label {% if required %}required-field{% endif %}">
        {{ label|default:field.label }}
        {% if required %}<span class="text-red-400 ml-1">*</span>{% endif %}
    </label>
    
    <div class="relative">
        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <i class="fas fa-calendar-alt text-white/40"></i>
        </div>
        <input type="date" 
               name="{{ field.name }}" 
               id="{{ field.id_for_label }}" 
               value="{{ field.value|date:'Y-m-d'|default:'' }}" 
               class="glass-input pl-10 {% if field.errors %}border-red-500/50 focus:border-red-500{% endif %}" 
               {% if min %}min="{{ min }}"{% endif %}
               {% if max %}max="{{ max }}"{% endif %}
               {% if required %}required{% endif %}
               {% if disabled %}disabled{% endif %}>
    </div>
    
    {% if field.errors %}
    <ul class="errorlist mt-2">
        {% for error in field.errors %}
        <li class="text-sm text-red-400">{{ error }}</li>
        {% endfor %}
    </ul>
    {% endif %}
</div>
{% endif %}

<!-- Time Picker Component -->
{% if type == 'time' %}
<div class="mb-4">
    <label for="{{ field.id_for_label }}" class="form-label {% if required %}required-field{% endif %}">
        {{ label|default:field.label }}
        {% if required %}<span class="text-red-400 ml-1">*</span>{% endif %}
    </label>
    
    <div class="relative">
        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <i class="fas fa-clock text-white/40"></i>
        </div>
        <input type="time" 
               name="{{ field.name }}" 
               id="{{ field.id_for_label }}" 
               value="{{ field.value|time:'H:i'|default:'' }}" 
               class="glass-input pl-10 {% if field.errors %}border-red-500/50 focus:border-red-500{% endif %}" 
               {% if required %}required{% endif %}
               {% if disabled %}disabled{% endif %}>
    </div>
    
    {% if field.errors %}
    <ul class="errorlist mt-2">
        {% for error in field.errors %}
        <li class="text-sm text-red-400">{{ error }}</li>
        {% endfor %}
    </ul>
    {% endif %}
</div>
{% endif %}

<!-- Submit Button Component -->
{% if type == 'submit' %}
<div class="flex justify-end space-x-3 mt-6">
    {% if cancel_url %}
    <a href="{{ cancel_url }}" class="glass-button">
        Cancel
    </a>
    {% endif %}
    
    <button type="submit" class="glass-button bg-blue-600/50 hover:bg-blue-600/70 transition-all duration-200" 
            {% if disabled %}disabled{% endif %}>
        <i class="fas fa-{{ icon|default:'save' }} mr-2"></i>
        {{ label|default:'Submit' }}
    </button>
</div>
{% endif %}

<!-- Form Errors Component -->
{% if type == 'errors' %}
{% if form.non_field_errors %}
<div class="alert-error p-4 rounded-lg mb-6">
    <div class="flex items-start">
        <i class="fas fa-exclamation-circle text-red-400 mr-3 mt-0.5"></i>
        <div>
            <h4 class="text-white font-medium mb-2">Form Errors</h4>
            <ul class="space-y-1">
                {% for error in form.non_field_errors %}
                <li class="text-sm text-red-400">{{ error }}</li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>
{% endif %}
{% endif %}

<!-- Search Field Component -->
{% if type == 'search' %}
<div class="relative">
    <input type="text" 
           name="{{ name|default:'search' }}" 
           value="{{ value|default:'' }}" 
           placeholder="{{ placeholder|default:'Search...' }}" 
           class="glass-input pl-10 pr-10 w-64">
    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
        <i class="fas fa-search text-white/40"></i>
    </div>
    {% if value %}
    <a href="{{ clear_url|default:'?' }}" class="absolute inset-y-0 right-0 pr-3 flex items-center text-white/40 hover:text-white">
        <i class="fas fa-times"></i>
    </a>
    {% endif %}
</div>
{% endif %}

<!-- Form Section Header -->
{% if type == 'section_header' %}
<div class="mb-4">
    <h3 class="text-lg font-semibold text-white flex items-center">
        {% if icon %}
        <i class="fas fa-{{ icon }} text-blue-400 mr-2"></i>
        {% endif %}
        {{ title }}
    </h3>
    {% if subtitle %}
    <p class="text-sm text-white/60 mt-1">{{ subtitle }}</p>
    {% endif %}
    <div class="h-px bg-white/10 mt-3"></div>
</div>
{% endif %}

<!-- Toggle Switch Component -->
{% if type == 'toggle' %}
<div class="mb-4">
    <label class="flex items-center justify-between cursor-pointer">
        <span class="text-white/80">{{ label|default:field.label }}</span>
        <div class="relative">
            <input type="checkbox" 
                   name="{{ field.name }}" 
                   id="{{ field.id_for_label }}" 
                   {% if field.value %}checked{% endif %}
                   class="sr-only peer">
            <div class="w-11 h-6 bg-white/10 rounded-full peer peer-checked:bg-blue-600/50 peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-0.5 after:left-0.5 after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
        </div>
    </label>
    
    {% if help_text %}
    <p class="text-xs text-white/40 mt-1">{{ help_text }}</p>
    {% endif %}
</div>
{% endif %}

<!-- Password Field with Toggle -->
{% if type == 'password' %}
<div class="mb-4">
    <label for="{{ field.id_for_label }}" class="form-label {% if required %}required-field{% endif %}">
        {{ label|default:field.label }}
        {% if required %}<span class="text-red-400 ml-1">*</span>{% endif %}
    </label>
    
    <div class="relative">
        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <i class="fas fa-lock text-white/40"></i>
        </div>
        <input type="password" 
               name="{{ field.name }}" 
               id="{{ field.id_for_label }}" 
               class="glass-input pl-10 pr-10 {% if field.errors %}border-red-500/50 focus:border-red-500{% endif %}" 
               placeholder="{{ placeholder|default:'Enter password' }}"
               {% if required %}required{% endif %}
               {% if disabled %}disabled{% endif %}>
        <button type="button" 
                onclick="togglePassword('{{ field.id_for_label }}')" 
                class="absolute inset-y-0 right-0 pr-3 flex items-center">
            <i class="fas fa-eye text-white/40 hover:text-white/60"></i>
        </button>
    </div>
    
    {% if help_text %}
    <p class="text-xs text-white/40 mt-1">{{ help_text }}</p>
    {% endif %}
    
    {% if field.errors %}
    <ul class="errorlist mt-2">
        {% for error in field.errors %}
        <li class="text-sm text-red-400">{{ error }}</li>
        {% endfor %}
    </ul>
    {% endif %}
</div>

<script>
function togglePassword(fieldId) {
    const field = document.getElementById(fieldId);
    const type = field.getAttribute('type') === 'password' ? 'text' : 'password';
    field.setAttribute('type', type);
    
    const button = field.nextElementSibling;
    const icon = button.querySelector('i');
    icon.classList.toggle('fa-eye');
    icon.classList.toggle('fa-eye-slash');
}
</script>
{% endif %}